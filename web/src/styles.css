@import 'tailwindcss';
@custom-variant dark (&:where(.dark, .dark *):not(:where(.light, .light *)));

@theme {
  --breakpoint-xs: 440px;

  /* Green palette — hue 140–147, chroma peaks at 400, even lightness steps */
  --color-green-50: oklch(0.97 0.04 140);
  --color-green-100: oklch(0.94 0.08 140);
  --color-green-200: oklch(0.9 0.14 141);
  --color-green-300: oklch(0.84 0.19 142);
  --color-green-400: oklch(0.76 0.22 142);
  --color-green-500: oklch(0.67 0.23 143);
  --color-green-600: oklch(0.58 0.19 144);
  --color-green-700: oklch(0.48 0.15 145);
  --color-green-800: oklch(0.39 0.11 146);
  --color-green-900: oklch(0.31 0.08 146);
  --color-green-950: oklch(0.21 0.05 147);

  /*--color-neutral-150: oklch(0.95 0 0);*/
  /*--color-neutral-300: oklch(0.87 0 0);*/
  --color-neutral-350: oklch(0.76 0 0);
  /*--color-neutral-400: oklch(0.71 0 0);*/
  /*--color-neutral-450: oklch(0.6 0 0);*/
  /*--color-neutral-500: oklch(0.56 0 0);*/
  --color-neutral-550: oklch(0.5 0 0);
  /*--color-neutral-600: oklch(0.44 0 0);*/
  --color-neutral-650: oklch(0.4 0 0);
  /*--color-neutral-700: oklch(37.1% 0 0);*/
  --color-neutral-750: oklch(31% 0 0);
  /*--color-neutral-800: oklch(26.9% 0 0);*/

  /* Surfaces & borders (neutral scale) */
  --color-bg: #fff;
  --color-surface: #fff;
  --color-surface-raised: var(--color-neutral-100);
  --color-border: var(--color-neutral-200);

  /* Text (neutral scale) */
  --color-text: var(--color-neutral-900);
  --color-text-muted: var(--color-neutral-550);
  --color-text-faint: var(--color-neutral-400);

  /* Semantic accent (custom green palette) */
  --color-accent: var(--color-green-700);
  --color-accent-hover: var(--color-green-600);

  /* Status */
  --color-error: var(--color-red-600);
  --color-success: var(--color-green-600);

  /* Core scale */
  --spacing: 0.25rem;
  --font-sans: system-ui, -apple-system, sans-serif;
  --font-mono: 'SF Mono', Menlo, Consolas, monospace;
  --radius-lg: 10px;
  --shadow-sm: 0 1px 2px oklch(0 0 0 / 0.05);
  --shadow-modal: 0 8px 24px oklch(0 0 0 / 0.12), 0 2px 8px oklch(0 0 0 / 0.08);
}

:root.dark {
  --color-bg: var(--color-neutral-950);
  --color-surface: var(--color-neutral-900);
  --color-surface-raised: var(--color-neutral-800);
  --color-border: var(--color-neutral-700);
  --color-text: var(--color-neutral-200);
  --color-text-muted: var(--color-neutral-350);
  --color-text-faint: var(--color-neutral-500);
  --color-accent: var(--color-green-400);
  --color-accent-hover: var(--color-green-300);
  --color-error: var(--color-red-500);
  --color-success: var(--color-green-400);
  --shadow-sm: 0 1px 2px oklch(0 0 0 / 0.2);
  --shadow-modal: 0 8px 32px oklch(0 0 0 / 0.9), 0 1px 16px oklch(0 0 0 / 0.8);
}

@layer base {
  body {
    @apply bg-bg text-text antialiased;

    background-image:
      /* Broad green curtain — top-center, sweeping right */
      /* Teal streak — upper-left, tall & narrow */
      radial-gradient(
        ellipse 35% 70% at 20% 10%,
        color-mix(in oklch, oklch(0.8 0.9 145) 4%, transparent),
        transparent 60%
      ),
      /* Emerald ribbon — offset right */
        radial-gradient(
          ellipse 40% 55% at 75% 15%,
          color-mix(in oklch, var(--color-green-100) 30%, transparent),
          transparent 65%
        ),
      /* Faint violet wisp — far left */
        radial-gradient(
          ellipse 25% 45% at 10% 25%,
          color-mix(in oklch, oklch(0.9 0.2 300) 15%, transparent),
          transparent 60%
        );
  }

  .dark body {
    background-image:
      /* Broad green curtain — top-center, sweeping right */
      radial-gradient(
        ellipse 120% 50% at 60% 0%,
        color-mix(in oklch, var(--color-green-900) 25%, transparent),
        color-mix(in oklch, var(--color-green-950) 12%, transparent) 30%,
        transparent 5%
      ),
      /* Teal streak — upper-left, tall & narrow */
        radial-gradient(
          ellipse 35% 70% at 20% 10%,
          color-mix(in oklch, oklch(0.35 0.11 155) 22%, transparent),
          transparent 60%
        ),
      /* Emerald ribbon — offset right */
        radial-gradient(
          ellipse 40% 55% at 75% 15%,
          color-mix(in oklch, var(--color-green-800) 18%, transparent),
          transparent 65%
        ),
      /* Faint violet wisp — far left */
        radial-gradient(
          ellipse 25% 45% at 10% 25%,
          color-mix(in oklch, oklch(0.3 0.08 300) 10%, transparent),
          transparent 60%
        );
  }

  .link {
    @apply text-accent underline transition-colors;
    text-underline-offset: 3px;
    text-decoration-color: color-mix(in oklch, currentColor 0%, transparent);
  }

  .link:hover {
    @apply underline;
    color: var(--color-accent-hover);
    text-underline-offset: 3px;
    text-decoration-color: color-mix(
      in oklch,
      var(--color-accent) 40%,
      transparent
    );
  }

  .link-subtle {
    @apply underline transition-colors;
    text-underline-offset: 3px;
    text-decoration-color: color-mix(in oklch, currentColor 0%, transparent);
  }

  .link-subtle:hover {
    @apply underline;
    color: var(--color-text-muted);
    text-underline-offset: 3px;
    text-decoration-color: color-mix(
      in oklch,
      var(--color-text-muted) 40%,
      transparent
    );
  }

  input[type='checkbox'],
  input[type='radio'] {
    width: 1.125rem; /* 18px, up from ~13px default */
    height: 1.125rem;
    accent-color: var(--color-green-600);
    cursor: pointer;
  }

  /* ── Consistent keyboard-focus indicator ── */
  a:focus-visible {
    outline: 2px solid color-mix(in oklch, var(--color-accent) 40%, transparent);
    outline-offset: 2px;
    border-radius: 2px;
  }

  button:focus-visible,
  summary:focus-visible,
  input[type='checkbox']:focus-visible,
  input[type='radio']:focus-visible {
    outline: 2px solid color-mix(in oklch, var(--color-accent) 40%, transparent);
    outline-offset: 2px;
  }
}

@layer components {
  .label {
    @apply flex items-center gap-1.5 font-medium text-neutral-700 dark:text-neutral-300;
  }

  .btn {
    --btn-color: var(--color-neutral-200);
    --btn-fg: var(--color-text);
    --btn-highlight: 1.06;

    @apply relative inline-flex cursor-pointer items-center justify-center gap-1.5 rounded-md px-3 py-2 font-semibold tracking-wide duration-200 ease-out select-none;
    transition-property:
      filter, transform, box-shadow, background-color, border-color;
    color: var(--btn-fg);
    background-image: linear-gradient(
      to bottom,
      color-mix(in oklch, var(--btn-color), white 15%),
      color-mix(in oklch, var(--btn-color), black 10%)
    );
    border: 1px solid color-mix(in oklch, var(--btn-color), white 9%);
    border-top-color: color-mix(in oklch, var(--btn-color), white 40%);
    border-bottom-color: color-mix(in oklch, var(--btn-color), black 20%);
    box-shadow:
      0 1px 2px oklch(0 0 0 / 0.06),
      0 1px 3px oklch(0 0 0 / 0.1);
    text-shadow: 0 1px 1px oklch(1 0 0 / 0.9);
    will-change: filter;

    .dark & {
      --btn-color: var(--color-neutral-600);
      --btn-highlight: 1.2;
      text-shadow: 0 1px 1px oklch(0 0 0 / 0.3);
    }
  }

  .btn:hover:not(:disabled) {
    filter: brightness(var(--btn-highlight));
  }

  .btn:active:not(:disabled) {
    filter: brightness(0.95);
    transform: translateY(0.5px);
    box-shadow:
      inset 0 2px 4px rgb(0 0 0 / 0.15),
      0 1px 2px rgb(0 0 0 / 0.1);
  }

  .btn:focus-visible {
    outline: 2px solid color-mix(in oklch, var(--color-accent) 40%, transparent);
    outline-offset: 2px;
  }

  .btn:disabled {
    @apply pointer-events-none opacity-50;
  }

  .btn-primary {
    --btn-color: var(--color-green-700);
    --btn-fg: #fff;
    --btn-highlight: 1.11;
    text-shadow: 0 1px 2px oklch(0 0 0 / 0.3);

    .dark & {
      --btn-color: var(--color-green-600);
    }
  }

  .btn-danger {
    --btn-color: var(--color-red-500);
    --btn-fg: #fff;
    --btn-highlight: 1.11;
    text-shadow: 0 1px 1px oklch(0 0 0 / 0.2);

    .dark & {
      --btn-color: var(--color-red-600);
    }
  }

  .btn-sm {
    @apply rounded-sm px-1.5 py-1 text-xs;
  }

  .btn-destructive-subtle {
    @apply flex items-center gap-1 rounded-md border border-transparent px-1 py-0.5 text-xs text-error/50 hover:border-error hover:bg-error/10 hover:text-error;
  }

  .code {
    @apply rounded border border-border/70 bg-surface-raised/70 px-1.5 py-0.5 font-mono text-xs;
  }

  /* ── Inputs ── */
  .input,
  .select,
  .textarea {
    @apply w-full rounded-md border border-border bg-surface px-3 py-2 text-text inset-shadow-sm transition-colors outline-none placeholder:text-neutral-500/50;
    &:focus {
      @apply border-accent ring-2 ring-accent/15;
    }
    &:disabled {
      @apply cursor-not-allowed bg-neutral-400/20 text-muted opacity-70;
    }
  }

  .alert-error {
    @apply rounded-md border border-error/30 bg-error/5 px-3 py-2.5 text-error;
  }

  .input-error {
    @apply border-error;
    &:focus {
      @apply border-error ring-2 ring-error/15;
    }
  }

  /*
  .select {
    @apply appearance-none bg-[length:1.25rem] bg-[right_0.5rem_center] bg-no-repeat pr-8;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%2371717a'%3E%3Cpath fill-rule='evenodd' d='M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z'/%3E%3C/svg%3E");
  }
  */

  .textarea {
    @apply resize-y;
  }

  .theme-toggle-track {
    box-shadow: inset 0 0 4px 1px rgb(100 100 100 / 0.15);
    .dark & {
      box-shadow: inset 0 0 6px rgb(0 0 0 / 0.7);
    }
  }

  .theme-toggle-knob {
    box-shadow:
      0 4px 6px 0px rgb(0 0 0 / 0.02),
      0 2px 3px 2px rgb(0 0 0 / 0.02);

    .theme-toggle-track:hover & {
      box-shadow:
        0 4px 6px 0px rgb(0 0 0 / 0.03),
        0 2px 3px 2px rgb(0 0 0 / 0.03);
    }

    .dark & {
      box-shadow:
        0 4px 6px 0px rgb(0 0 0 / 0.25),
        0 0px 1px 3px rgb(0 0 0 / 0.05),
        inset 0 0 2px 1px rgb(255 255 255 / 0.05);
    }
  }

  .card {
    @apply rounded-lg border border-neutral-300/50 bg-neutral-100 p-4 shadow-md backdrop-blur-md sm:p-6 dark:border-neutral-700/35 dark:bg-neutral-950/40;
  }

  /* ── Modal (native <dialog>) ── */
  .modal-backdrop {
    @apply m-0 h-full max-h-full w-full max-w-full overflow-y-auto border-none bg-transparent p-0;
    /* Centre the inner card (upper-biased) */
    @apply fixed inset-0 flex items-start justify-center px-4 pb-4 text-text;
    padding-top: clamp(2.5rem, calc(20vh - 40px), 10rem);

    /* Keep dialog in top-layer during exit animation */
    transition:
      display 0.2s allow-discrete,
      overlay 0.2s allow-discrete;

    /* Backdrop: closed state (transparent) */
    &::backdrop {
      background: oklch(0 0 0 / 0);
      transition:
        background 0.15s ease-in,
        display 0.15s allow-discrete,
        overlay 0.15s allow-discrete;
    }

    /* Backdrop: open state */
    &[open]::backdrop {
      background: oklch(0 0 0 / 0.3);
      transition: background 0.2s ease-out;
    }

    /* Card: closed state (scaled down + hidden) */
    & > * {
      box-shadow: var(--shadow-modal);
      opacity: 0;
      transform: scale(0.96);
      transition:
        opacity 0.1s ease-in,
        transform 0.1s ease-in;
    }

    /* Card: open state */
    &[open] > * {
      opacity: 1;
      transform: scale(1);
      transition:
        opacity 0.2s ease-out 0.08s,
        transform 0.2s ease-out 0.08s;
    }

    /* Must re-assert display:none since @apply flex overrides the UA default */
    &:not([open]) {
      display: none;
    }

    /* Entry from display:none — where the open animation starts */
    @starting-style {
      &[open]::backdrop {
        background: oklch(0 0 0 / 0);
      }

      &[open] > * {
        opacity: 0;
        transform: scale(0.96);
      }
    }
  }
}

@utility text-muted {
  color: var(--color-text-muted);
}
@utility text-faint {
  color: var(--color-text-faint);
}
@utility inset-shadow-border-3 {
  --tw-inset-shadow:
    inset 1px 0 0 0 color-mix(in srgb, var(--color-border) 50%, transparent),
    inset -1px 0 0 0 color-mix(in srgb, var(--color-border) 50%, transparent),
    inset 0 -1px 0 0 color-mix(in srgb, var(--color-border) 50%, transparent);
}
