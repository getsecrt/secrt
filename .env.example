# secrt-server configuration
# Copy to .env and adjust for your environment.
#
# In development, most values have sensible defaults — you only need to set
# the database connection and security peppers.
#
# In production (ENV=production), API_KEY_PEPPER and SESSION_TOKEN_PEPPER
# are required and the server will refuse to start without them.

# ---------------------------------------------------------------------------
# Core
# ---------------------------------------------------------------------------

# Environment name. "production" enforces stricter validation (peppers required).
# Default: development
ENV=development

# Bind address for HTTP listener (usually loopback behind a reverse proxy).
# A bare ":PORT" binds to 0.0.0.0.
# Default: :8080
LISTEN_ADDR=127.0.0.1:8080

# Public origin used to build share URLs returned by the API.
# No trailing slash. In dev, point at the Vite dev server for correct share links.
# Default: http://localhost:8080
PUBLIC_BASE_URL=http://localhost:5173

# tracing filter level: error | warn | info | debug | trace
# Default: info
LOG_LEVEL=info

# ---------------------------------------------------------------------------
# Database
# ---------------------------------------------------------------------------
# Set DATABASE_URL for a full connection string, OR use the DB_* fields below.
# If DATABASE_URL is set, the individual DB_* fields are ignored.

# DATABASE_URL=postgres://secrt_app:password@127.0.0.1:5432/secrt?sslmode=disable

DB_HOST=127.0.0.1
DB_PORT=5432
DB_NAME=secrt
DB_USER=secrt_app
DB_PASSWORD=
# disable | require | verify-ca | verify-full
DB_SSLMODE=disable
# Path to CA cert file when DB_SSLMODE uses certificate verification.
DB_SSLROOTCERT=

# ---------------------------------------------------------------------------
# Security
# ---------------------------------------------------------------------------
# HMAC peppers are mixed into hashes stored at rest. Changing them after
# deployment invalidates all existing API keys / sessions.
#
# In production, generate with: openssl rand -base64 32

# HMAC pepper for API-key verifier hashes stored in the database.
# Required when ENV=production.
API_KEY_PEPPER=dev-api-pepper-not-for-production

# HMAC pepper for session bearer-token hashes stored in the database.
# Required when ENV=production.
SESSION_TOKEN_PEPPER=dev-session-pepper-not-for-production

# ---------------------------------------------------------------------------
# Secret size / quota limits
# ---------------------------------------------------------------------------

# Max envelope JSON bytes for anonymous (public) create requests.
# Default: 262144 (256 KiB)
PUBLIC_MAX_ENVELOPE_BYTES=262144

# Max envelope JSON bytes for authenticated create requests.
# Default: 1048576 (1 MiB)
AUTHED_MAX_ENVELOPE_BYTES=1048576

# Max active secrets per anonymous owner (IP-derived owner key).
# Default: 10
PUBLIC_MAX_SECRETS=10

# Max active stored bytes per anonymous owner.
# Default: 2097152 (2 MiB)
PUBLIC_MAX_TOTAL_BYTES=2097152

# Max active secrets per authenticated API key owner.
# Default: 1000
AUTHED_MAX_SECRETS=1000

# Max active stored bytes per authenticated API key owner.
# Default: 20971520 (20 MiB)
AUTHED_MAX_TOTAL_BYTES=20971520

# ---------------------------------------------------------------------------
# Rate limits (token bucket)
# ---------------------------------------------------------------------------

# Public (anonymous) create — requests per second.
# Default: 0.5
PUBLIC_CREATE_RATE=0.5
# Public create — burst size.
# Default: 6
PUBLIC_CREATE_BURST=6

# Claim endpoint — requests per second.
# Default: 1.0
CLAIM_RATE=1.0
# Claim — burst size.
# Default: 10
CLAIM_BURST=10

# Authenticated create — requests per second.
# Default: 2.0
AUTHED_CREATE_RATE=2.0
# Authenticated create — burst size.
# Default: 20
AUTHED_CREATE_BURST=20

# ---------------------------------------------------------------------------
# API key registration limits
# ---------------------------------------------------------------------------

# Token-bucket rate for API key registration endpoint (per client IP).
# Default: 0.5
APIKEY_REGISTER_RATE=0.5
# Token-bucket burst size.
# Default: 6
APIKEY_REGISTER_BURST=6

# Hard cap per account in a rolling 1-hour window.
# Default: 5
APIKEY_REGISTER_ACCOUNT_MAX_PER_HOUR=5
# Hard cap per account in a rolling 24-hour window.
# Default: 20
APIKEY_REGISTER_ACCOUNT_MAX_PER_DAY=20

# Hard cap per client IP in a rolling 1-hour window.
# Default: 5
APIKEY_REGISTER_IP_MAX_PER_HOUR=5
# Hard cap per client IP in a rolling 24-hour window.
# Default: 20
APIKEY_REGISTER_IP_MAX_PER_DAY=20
